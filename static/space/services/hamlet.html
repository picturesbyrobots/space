<!DOCTYPE html>
<script type=module>

import Observers from '../js/Observers.js';
import Service from '../js/Service.js';

class HamletService {
  constructor() {
    this.observers = new Observers();
  }

  setWs(ws) {
    this.ws = ws;
    console.log('setWS')
    ws.observe('hmlt_chat', message => {
      console.log(message)
      this.observers.fire('hmlt_message', message)
    })

  }
}



const hamletService = new HamletService();
Service.get('ws', ws => hamletService.setWs(ws));

class HamletClient {
  constructor(context) {
    this.context = context;
  }

  observe(key, cb) {
    return hamletService.observers.add(key, this.context, cb);
  }

  curtainUp(data) {
      hamletService.observers.fire('curtainUp',data)
  }
  
  
}

 const perfServiceCB = context => new HamletClient(context);
 Service.register('hamlet', perfServiceCB);




</script>
